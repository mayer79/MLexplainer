<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using flashlight with caret • flashlight</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using flashlight with caret">
<meta property="og:description" content="flashlight">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flashlight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/p1_flashlight.html">Using flashlight</a>
    </li>
    <li>
      <a href="../articles/p2_caret.html">Using flashlight with caret</a>
    </li>
    <li>
      <a href="../articles/p3_mlr3.html">Using flashlight with mlr3</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mayer79/flashlight/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using flashlight with caret</h1>
            
            <h4 data-toc-skip class="date">2023-04-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mayer79/flashlight/blob/HEAD/vignettes/p2_caret.Rmd" class="external-link"><code>vignettes/p2_caret.Rmd</code></a></small>
      <div class="hidden name"><code>p2_caret.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/MetricsWeighted" class="external-link">MetricsWeighted</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/flashlight" class="external-link">flashlight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette shows how to use <code>flashlight</code> for
interpretation of models trained with <code>caret</code>. It is very
straightforward - no extra line of code is required.</p>
</div>
<div class="section level2">
<h2 id="training-a-linear-regression-and-a-regression-tree-on-the-cars-data-set">Training a linear regression and a regression tree on the
<code>cars</code> data set<a class="anchor" aria-label="anchor" href="#training-a-linear-regression-and-a-regression-tree-on-the-cars-data-set"></a>
</h2>
<p>The <code>caret</code> package contains some wonderful data sets for
playing, e.g. the cars data set.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    804 obs. of  18 variables:</span></span>
<span><span class="co">#&gt;  $ Price      : num  22661 21725 29143 30732 33359 ...</span></span>
<span><span class="co">#&gt;  $ Mileage    : int  20105 13457 31655 22479 17590 23635 17381 27558 25049 17319 ...</span></span>
<span><span class="co">#&gt;  $ Cylinder   : int  6 6 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;  $ Doors      : int  4 2 2 2 2 2 2 2 2 4 ...</span></span>
<span><span class="co">#&gt;  $ Cruise     : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Sound      : int  0 1 1 0 1 0 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Leather    : int  0 0 1 0 1 0 1 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ Buick      : int  1 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Cadillac   : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Chevy      : int  0 1 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Pontiac    : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Saab       : int  0 0 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Saturn     : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ convertible: int  0 0 1 1 1 1 1 1 1 0 ...</span></span>
<span><span class="co">#&gt;  $ coupe      : int  0 1 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ hatchback  : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sedan      : int  1 0 0 0 0 0 0 0 0 1 ...</span></span>
<span><span class="co">#&gt;  $ wagon      : int  0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>We then use the data to fit two types of regression to predict
log(Price) by log(Mileage) and the other covariables. Car mades are
already dummy coded. We will revert this in order to simplify the
explainer process. Additionally, we represent some 0-1 dummies by nice,
meaningful factors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">undo_dummies</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html" class="external-link">data.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">cols</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">no_yes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Prepare data</span></span>
<span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Price</span><span class="op">)</span>,</span>
<span>         Mileage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Mileage</span><span class="op">)</span>,</span>
<span>         Made <span class="op">=</span> <span class="fu">undo_dummies</span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Buick"</span>, <span class="st">"Cadillac"</span>, <span class="st">"Chevy"</span>, <span class="st">"Pontiac"</span>, <span class="st">"Saab"</span>, <span class="st">"Saturn"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cruise"</span>, <span class="st">"Sound"</span>, <span class="st">"Leather"</span><span class="op">)</span>, <span class="va">no_yes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response and covariables</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Price"</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinder"</span>, <span class="st">"Doors"</span>, <span class="st">"Cruise"</span>, <span class="st">"Sound"</span>, <span class="st">"Leather"</span>, <span class="st">"Mileage"</span>, <span class="st">"Made"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">cars</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va">cars</span><span class="op">[</span><span class="va">idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">te</span> <span class="op">&lt;-</span> <span class="va">cars</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Fit the models with caret (without tuning)</span></span>
<span><span class="va">fit_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, </span>
<span>                data <span class="op">=</span> <span class="va">tr</span>, </span>
<span>                method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>                tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_rpart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html" class="external-link">reformulate</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, </span>
<span>                   data <span class="op">=</span> <span class="va">tr</span>,  </span>
<span>                   method <span class="op">=</span> <span class="st">"rpart"</span>, </span>
<span>                   xval <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cp <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span>,</span>
<span>                   trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="flashlights">flashlights<a class="anchor" aria-label="anchor" href="#flashlights"></a>
</h2>
<p>Then we collect all infos to build (multi-)flashlights, the core
objects for explaining and comparing the models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flashlight.html">flashlight</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit_lm</span>, label <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span>
<span><span class="va">fl_rpart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flashlight.html">flashlight</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit_rpart</span>, label <span class="op">=</span> <span class="st">"rpart"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multiflashlight.html">multiflashlight</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fl_lm</span>, <span class="va">fl_rpart</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">y</span>, data <span class="op">=</span> <span class="va">te</span>, </span>
<span>                       metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>RMSE <span class="op">=</span> <span class="va">rmse</span>, `R-Squared` <span class="op">=</span> <span class="va">r_squared</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="explaining-the-models">Explaining the models<a class="anchor" aria-label="anchor" href="#explaining-the-models"></a>
</h2>
<p>Let us go through a selection of explainability tools.</p>
<div class="section level3">
<h3 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h3>
<p>The models perform essentially similar.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/light_performance.html">light_performance</a></span><span class="op">(</span><span class="va">fls</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-5-1.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="importance">Importance<a class="anchor" aria-label="anchor" href="#importance"></a>
</h3>
<p>Let’s study permutation importance regarding RMSE metric.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/light_importance.html">light_importance</a></span><span class="op">(</span><span class="va">fls</span>, m_repetitions <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-6-1.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="effects">Effects<a class="anchor" aria-label="anchor" href="#effects"></a>
</h3>
<p>Now, let’s look at a couple of ways to visualize effects.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Individual conditional expectations (ICE). Using a seed guarantees the same observations across models</span></span>
<span><span class="fu"><a href="../reference/light_ice.html">light_ice</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Cylinder"</span>, n_max <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">54</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-1.png" width="528"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Partial dependence profiles</span></span>
<span><span class="fu"><a href="../reference/light_profile.html">light_profile</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Cylinder"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-2.png" width="528"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/light_profile.html">light_profile</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Cylinder"</span>, by <span class="op">=</span> <span class="st">"Leather"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-3.png" width="528"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Accumulated local effects</span></span>
<span><span class="fu"><a href="../reference/light_profile.html">light_profile</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Cylinder"</span>, type <span class="op">=</span> <span class="st">"ale"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-4.png" width="528"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># M-Plots</span></span>
<span><span class="fu"><a href="../reference/light_profile.html">light_profile</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Mileage"</span>, type <span class="op">=</span> <span class="st">"predicted"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-5.png" width="528"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Response profiles, prediction profiles, partial dependence in one</span></span>
<span><span class="va">eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/light_effects.html">light_effects</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="st">"Cylinder"</span><span class="op">)</span> </span>
<span><span class="va">eff</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_counts.html">plot_counts</a></span><span class="op">(</span><span class="va">eff</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-7-6.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="interaction-strength">Interaction strength<a class="anchor" aria-label="anchor" href="#interaction-strength"></a>
</h3>
<p>How strong are the pairwise interactions among the four most
important predictors? Surprise, surprise: for the linear regression,
there are none!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/light_interaction.html">light_interaction</a></span><span class="op">(</span><span class="va">fls</span>, v <span class="op">=</span> <span class="fu"><a href="../reference/most_important.html">most_important</a></span><span class="op">(</span><span class="va">imp</span>, <span class="fl">4</span><span class="op">)</span>, pairwise <span class="op">=</span> <span class="cn">TRUE</span>, n_max <span class="op">=</span> <span class="fl">50</span>, seed <span class="op">=</span> <span class="fl">63</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-8-1.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="variable-contribution-breakdown-for-single-observation">Variable contribution breakdown for single observation<a class="anchor" aria-label="anchor" href="#variable-contribution-breakdown-for-single-observation"></a>
</h3>
<p>We can explain the predictions of single observations…</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/light_breakdown.html">light_breakdown</a></span><span class="op">(</span><span class="va">fls</span>, new_obs <span class="op">=</span> <span class="va">te</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, facet_ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="p2_caret_files/figure-html/unnamed-chunk-9-1.png" width="528"></p>
<p>There is much more to explore: SHAP values, global surrogate models,
etc.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
