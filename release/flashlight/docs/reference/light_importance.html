<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Variable Importance — light_importance • flashlight</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Variable Importance — light_importance" />
<meta property="og:description" content="Two algorithms to calculate variable importance are available: (a) Permutation importance and (b) SHAP importance. Algorithm (a) measures importance of variable v as the drop in performance by permuting the values of v, see Fisher et al. 2018 (reference below). Algorithm (b) measures variable importance by averaging absolute SHAP values." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flashlight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flashlight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mayer79/flashlight/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Variable Importance</h1>
    <small class="dont-index">Source: <a href='https://github.com/mayer79/flashlight/blob/master/R/light_importance.R'><code>R/light_importance.R</code></a></small>
    <div class="hidden name"><code>light_importance.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Two algorithms to calculate variable importance are available: (a) Permutation importance and (b) SHAP importance. Algorithm (a) measures importance of variable v as the drop in performance by permuting the values of v, see Fisher et al. 2018 (reference below). Algorithm (b) measures variable importance by averaging absolute SHAP values.</p>
    </div>

    <pre class="usage"><span class='fu'>light_importance</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>light_importance</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for flashlight</span>
<span class='fu'>light_importance</span>(
  <span class='no'>x</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>data</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>by</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"permutation"</span>, <span class='st'>"shap"</span>),
  <span class='kw'>v</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n_max</span> <span class='kw'>=</span> <span class='fl'>Inf</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>m_repetitions</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>metric</span> <span class='kw'>=</span> <span class='no'>x</span>$<span class='no'>metrics</span>[<span class='fl'>1</span>],
  <span class='kw'>lower_is_better</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>use_linkinv</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>metric_name</span> <span class='kw'>=</span> <span class='st'>"metric"</span>,
  <span class='kw'>value_name</span> <span class='kw'>=</span> <span class='st'>"value"</span>,
  <span class='kw'>error_name</span> <span class='kw'>=</span> <span class='st'>"error"</span>,
  <span class='kw'>label_name</span> <span class='kw'>=</span> <span class='st'>"label"</span>,
  <span class='kw'>variable_name</span> <span class='kw'>=</span> <span class='st'>"variable"</span>,
  <span class='no'>...</span>
)

<span class='co'># S3 method for multiflashlight</span>
<span class='fu'>light_importance</span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object of class <code>flashlight</code> or <code>multiflashlight</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <code>light_performance</code>. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>An optional <code>data.frame</code>. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>An optional vector of column names used to additionally group the results.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Type of importance: "permutation" (default) or "shap". "shap" is only available if a "shap" object is contained in <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>v</th>
      <td><p>Vector of variables to assess importance for. Defaults to all variables in <code>data</code> except "by" and "y".</p></td>
    </tr>
    <tr>
      <th>n_max</th>
      <td><p>Maximum number of rows to consider. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An integer random seed used to select and shuffle rows. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>m_repetitions</th>
      <td><p>Number of permutations. Defaults to 1. A value above 1 provides more stable estimates of variable importance and allows the calculation of standard errors measuring the uncertainty from permuting. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>metric</th>
      <td><p>An optional named list of length one with a metric as element. Defaults to the first metric in the flashlight. The metric needs to be a function with at least four arguments: actual, predicted, case weights w and <code>...</code>. Irrelevant for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>lower_is_better</th>
      <td><p>Logical flag indicating if lower values in the metric are better or not. If set to FALSE, the increase in metric is multiplied by -1. Not used for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>use_linkinv</th>
      <td><p>Should retransformation function be applied? Default is FALSE. Not uses for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>metric_name</th>
      <td><p>Name of the resulting column containing the name of the metric. Defaults to "metric". Irrelevant for <code>type = "shap"</code>.</p></td>
    </tr>
    <tr>
      <th>value_name</th>
      <td><p>Column name in resulting <code>data</code> containing the variable importance. Defaults to "value".</p></td>
    </tr>
    <tr>
      <th>error_name</th>
      <td><p>Column name in resulting <code>data</code> containing the standard error of permutation importance. Defaults to "error".</p></td>
    </tr>
    <tr>
      <th>label_name</th>
      <td><p>Column name in resulting <code>data</code> containing the label of the flashlight. Defaults to "label".</p></td>
    </tr>
    <tr>
      <th>variable_name</th>
      <td><p>Column name in resulting <code>data</code> containing the variable names. Defaults to "variable".</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>light_importance</code>, <code>light</code> (and a list) with the following elements.</p><ul>
<li><p><code>data</code> A tibble with results. Can be used to build fully customized visualizations.</p></li>
<li><p><code>by</code> Same as input <code>by</code>.</p></li>
<li><p><code>type</code> Same as input <code>type</code>. For information only.</p></li>
<li><p><code>metric_name</code> Column name representing the name of the metric. For information only.</p></li>
<li><p><code>value_name</code> Same as input <code>value_name</code>.</p></li>
<li><p><code>error_name</code> Same as input <code>error_name</code>.</p></li>
<li><p><code>label_name</code> Same as input <code>label_name</code>.</p></li>
<li><p><code>variable_name</code> Same as input <code>variable_name</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For algorithm (a), the minimum required elements in the (multi-) flashlight are "y", "predict_function", "model", "data" and "metrics". For algorithm (b), the only required element is "shap". Call <code>add_shap</code> once to add such object.
Note: The values of the permutation algorithm (a) are on the scale of the selected metric. For shap algorithm (b), the values are on the scale of absolute values of the predictions.</p>
    <h2 class="hasAnchor" id="methods-by-class-"><a class="anchor" href="#methods-by-class-"></a>Methods (by class)</h2>

    
<ul>
<li><p><code>default</code>: Default method not implemented yet.</p></li>
<li><p><code>flashlight</code>: Variable importance for a flashlight.</p></li>
<li><p><code>multiflashlight</code>: Variable importance for a multiflashlight.</p></li>
</ul>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Fisher A., Rudin C., Dominici F. (2018). All Models are Wrong but many are Useful: Variable Importance for Black-Box, Proprietary, or Misspecified Prediction Models, using Model Class Reliance. ArXiv &lt;arxiv.org/abs/1801.01489&gt;.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='most_important.html'>most_important</a></code>, <code><a href='plot.light_importance.html'>plot.light_importance</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>fit_part</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>Sepal.Length</span> ~ <span class='no'>Petal.Length</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>)
<span class='no'>fit_full</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>Sepal.Length</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>)
<span class='no'>mod_full</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='flashlight.html'>flashlight</a></span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>fit_full</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"full"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"Sepal.Length"</span>)
<span class='no'>mod_part</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='flashlight.html'>flashlight</a></span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>fit_part</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"part"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"Sepal.Length"</span>)
<span class='no'>mods</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='multiflashlight.html'>multiflashlight</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>mod_full</span>, <span class='no'>mod_part</span>))
<span class='fu'>light_importance</span>(<span class='no'>mods</span>)</div><div class='output co'>#&gt; 
#&gt; I am an object with class(es) light_importance_multi, light_importance, light, list 
#&gt; 
#&gt; data.frames (maximum 6 rows shown):
#&gt; 
#&gt;  data 
#&gt; <span style='color: #555555;'># A tibble: 6 x 5</span><span>
#&gt;   label metric variable      value error
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;lgl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> full  rmse   Sepal.Width  0.089</span><span style='text-decoration: underline;'>8</span><span> </span><span style='color: #BB0000;'>NA</span><span>   
#&gt; </span><span style='color: #555555;'>2</span><span> full  rmse   Petal.Length 1.72   </span><span style='color: #BB0000;'>NA</span><span>   
#&gt; </span><span style='color: #555555;'>3</span><span> full  rmse   Petal.Width  0.171  </span><span style='color: #BB0000;'>NA</span><span>   
#&gt; </span><span style='color: #555555;'>4</span><span> full  rmse   Species      0.455  </span><span style='color: #BB0000;'>NA</span><span>   
#&gt; </span><span style='color: #555555;'>5</span><span> part  rmse   Sepal.Width  0      </span><span style='color: #BB0000;'>NA</span><span>   
#&gt; </span><span style='color: #555555;'>6</span><span> part  rmse   Petal.Length 0.733  </span><span style='color: #BB0000;'>NA</span><span>   </div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


