<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add SHAP values to (multi-)flashlight — add_shap • flashlight</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Add SHAP values to (multi-)flashlight — add_shap" />
<meta property="og:description" content="The function calls light_breakdown for n_shap observations and adds the resulting (approximate) SHAP decompositions as static element &quot;shap&quot; to the (multi)-flashlight for further analyses. We offer two approximations to SHAP: For visit_strategy = &quot;importance&quot;, the breakdown algorithm (see reference) is used with importance based visit order. Use the default visit_strategy = &quot;permutation&quot; to run breakdown for multiple random permutations, averaging the results. This approximation will be closer to exact SHAP values, but very slow. Most available arguments can be chosen to reduce computation time." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flashlight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/flashlight.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mayer79/flashlight/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add SHAP values to (multi-)flashlight</h1>
    <small class="dont-index">Source: <a href='https://github.com/mayer79/flashlight/blob/master/R/add_shap.R'><code>R/add_shap.R</code></a></small>
    <div class="hidden name"><code>add_shap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function calls <code>light_breakdown</code> for <code>n_shap</code> observations and adds the resulting (approximate) SHAP decompositions as static element "shap" to the (multi)-flashlight for further analyses. We offer two approximations to SHAP: For <code>visit_strategy = "importance"</code>, the breakdown algorithm (see reference) is used with importance based visit order. Use the default <code>visit_strategy = "permutation"</code> to run breakdown for multiple random permutations, averaging the results. This approximation will be closer to exact SHAP values, but very slow. Most available arguments can be chosen to reduce computation time.</p>
    </div>

    <pre class="usage"><span class='fu'>add_shap</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>add_shap</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for flashlight</span>
<span class='fu'>add_shap</span>(
  <span class='no'>x</span>,
  <span class='kw'>v</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>visit_strategy</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"permutation"</span>, <span class='st'>"importance"</span>, <span class='st'>"v"</span>),
  <span class='kw'>n_shap</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>n_max</span> <span class='kw'>=</span> <span class='fl'>Inf</span>,
  <span class='kw'>n_perm</span> <span class='kw'>=</span> <span class='fl'>12</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>use_linkinv</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>variable_name</span> <span class='kw'>=</span> <span class='st'>"variable"</span>,
  <span class='no'>...</span>
)

<span class='co'># S3 method for multiflashlight</span>
<span class='fu'>add_shap</span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object of class <code>flashlight</code> or <code>multiflashlight</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed from or to other methods.</p></td>
    </tr>
    <tr>
      <th>v</th>
      <td><p>Vector of variables to assess contribution for. Defaults to all except those specified by "y", "w" and "by".</p></td>
    </tr>
    <tr>
      <th>visit_strategy</th>
      <td><p>In what sequence should variables be visited? By <code>n_perm</code> "permutation" (slow), by "importance" (fast), or as "v" (not recommended).</p></td>
    </tr>
    <tr>
      <th>n_shap</th>
      <td><p>Number of SHAP decompositions to calculate.</p></td>
    </tr>
    <tr>
      <th>n_max</th>
      <td><p>Maximum number of rows in <code>data</code> to consider in the reference data. Set to lower value if <code>data</code> is large.</p></td>
    </tr>
    <tr>
      <th>n_perm</th>
      <td><p>Number of permutations of random visit sequences. Only used if <code>visit_strategy = "permutation"</code>.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An integer random seed.</p></td>
    </tr>
    <tr>
      <th>use_linkinv</th>
      <td><p>Should retransformation function be applied? We suggest to keep the default (<code>FALSE</code>) as the values can be retransformed later.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Should progress bar be shown? Default is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>variable_name</th>
      <td><p>Column name in <code>data</code> of element "shap" containing the variable names. Defaults to "variable".</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>flashlight</code> or <code>multiflashlight</code> with additional element "shap" of class "shap" (and "list").</p>
    <h2 class="hasAnchor" id="methods-by-class-"><a class="anchor" href="#methods-by-class-"></a>Methods (by class)</h2>

    
<ul>
<li><p><code>default</code>: Default method not implemented yet.</p></li>
<li><p><code>flashlight</code>: Variable attribution to single observation for a flashlight.</p></li>
<li><p><code>multiflashlight</code>: Add SHAP to multiflashlight.</p></li>
</ul>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>A. Gosiewska and P. Biecek (2019). IBREAKDOWN: Uncertainty of model explanations for non-additive predictive models. ArXiv &lt;arxiv.org/abs/1903.11420&gt;.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>Sepal.Length</span> ~ <span class='no'>.</span> + <span class='no'>Petal.Length</span>:<span class='no'>Species</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='flashlight.html'>flashlight</a></span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>fit</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"lm"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>iris</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"Sepal.Length"</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>add_shap</span>(<span class='no'>x</span>)
<span class='fu'><a href='is.flashlight.html'>is.shap</a></span>(<span class='no'>x</span>$<span class='no'>shap</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='fu'><a href='light_importance.html'>light_importance</a></span>(<span class='no'>x</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"shap"</span>))
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='fu'><a href='light_scatter.html'>light_scatter</a></span>(<span class='no'>x</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"shap"</span>, <span class='kw'>v</span> <span class='kw'>=</span> <span class='st'>"Petal.Length"</span>))
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


